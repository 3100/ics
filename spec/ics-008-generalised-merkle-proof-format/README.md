---
ics: 8
title: Generalised Merkle Proof Format
stage: draft
category: ibc/tao
kind: instantiation
author: Christopher Goes <cwgoes@tendermint.com>, Ethan Frey
created: 2019-12-21
modified: 2020-01-26
implements: 23
---

## Synopsis

This document defines a generic, cross-language representation of Merkle proofs and associated specifications which allow for their safe verification.

### Motivation

Tendermint & other consensus algorithms which IBC will support can be connected to many different applications, which may for various application-specific reasons prefer to store their application data in different kinds of Merkle trees.
A common proof format will make it easier to support these different kinds of trees in IBC, and potentially allow for new trees to be added without requiring an upgrade of the IBC specification or protocol itself.

### Definitions

All terms are defined as per [ICS 23](../ics-023-vector-commitments).

### Desired Properties

- Must satisfy all properties & invariants defined in [ICS 23](../ics-023-vector-commitments).
- Should be as generic as possible to support different sorts of Merkle trees.

## Technical Specification

### Data Structures

The `HashOp` enumeration identifies a particular hash function to be used while verifying a proof.

```typescript
type HashOp = int32
```

The `LengthOp` enumeration identifies a particular prefixing & padding format to be used while verifying a proof.

```typescript
type LengthOp = int32
```

The `ExistenceProof` struct contains the requisite information to verify the proof of a particular value stored at a particular key.

```typescript
interface ExistenceProof {
  key: []byte
  value: []byte
  Leaf: LeafOp
  Path: []InnerOp
}
```

The `NonExistenceProof` struct contains the requisite information to verify the proof that no value is stored at a particular key.

```typescript
interface NonExistenceProof {
  key: []byte
  left: ExistenceProof
  right: ExistenceProof
}
```

A `CommitmentProof` is either an `ExistenceProof` or a `NonExistenceProof`.

```typescript
type CommitmentProof = ExistenceProof | NonExistenceProof
```

The `LeafOp` struct contains the requisite information to verify the leaf of a Merkle tree once inner nodes have been verified.

```typescript
interface LeafOp {
  hash: HashOp
  prehashKey: HashOp
  prehashValue: HashOp
  length: LengthOp
  prefix: []byte
}
```

The `InnerOp` struct contains the requisite information to verify an inner node of the Merkle tree.

```typescript
interface InnerOp {
  hash: HashOp
  prefix: []byte
  suffix: []byte
}
```

The `InnerSpec` struct defines the parameters necessary to verify inner nodes of a particular Merkle tree.

```typescript
interface InnerSpec {
  childOrder: []int32
  childSize: int32
  minPrefixLength: int32
  maxPrefixLength: int32
  emptyChild: []byte
}
```

The `ProofSpec` struct defines all parameters necessary for verifying `CommitmentProof`s generated by a particular Merkle tree.

```typescript
interface ProofSpec {
  leafSpec: LeafOp
  innerSpec: InnerSpec
}
```

### Sub-protocols

(sub-protocols, if applicable)

### Properties & Invariants


## Backwards Compatibility

Not applicable.

## Forwards Compatibility

Compatible with any tree with an appropriate associated `ProofSpec`.

## Example Implementation

Go, Javascript, and Rust in [confio/ics23](https://github.com/confio/ics23).

## Other Implementations

None so far.

## History

- January 26, 2020 - Initial draft version

## Copyright

All content herein is licensed under [Apache 2.0](https://www.apache.org/licenses/LICENSE-2.0).
